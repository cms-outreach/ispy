<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>ispy by cms-outreach</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>ispy</h1>
        <p>iSpy Client</p>

        <p class="view"><a href="https://github.com/cms-outreach/ispy">View the Project on GitHub <small>cms-outreach/ispy</small></a></p>


        <ul>
          <li><a href="https://github.com/cms-outreach/ispy/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/cms-outreach/ispy/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/cms-outreach/ispy">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="what-is-this" class="anchor" href="#what-is-this" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is this?</h1>

<p>iSpy is a powerful and lightweight event display used for the CMS experiment at the LHC. It reads in an ig file which contains event and geometry information.</p>

<h1>
<a id="what-is-an-ig-file" class="anchor" href="#what-is-an-ig-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is an ig file?</h1>

<p>A .ig file is a zip archive (unzippable via unzip or similar) containing one file per event. Each event file uses a relational database-like structure, described using JSON.</p>

<h2>
<a id="ig-file-format" class="anchor" href="#ig-file-format" aria-hidden="true"><span class="octicon octicon-link"></span></a>ig-file format:</h2>

<p>ig files have a flat directory structure with a separate directory per run (run directory). Each run directory contains one or more files describing a given event (ig event file) each. The associated run number and the event number are, respectively, the file name for the run directory and for the ig event file.</p>

<p>The ig-event-file format is a valid JSON or python dictionary. The format defines three categories of objects: types, collections and associations-sets.</p>

<p>Syntax:</p>

<p>ig-event-file ::= { 'Types': type-descriptions, 'Collections': collections, 'Associations': association-sets }</p>

<h3>
<a id="types" class="anchor" href="#types" aria-hidden="true"><span class="octicon octicon-link"></span></a>Types</h3>

<p>Types are a mapping of a type-name and its associated type-description. The type-description defines the types of the objects that are to be found in the Collection which uses the same string as the type-name to be identified. The attributes (i.e. columns) of a Collection are defined by an attribute name and an attribute type. The former is just a string label, while the second one define the kind of object which is stored in the attribute, all of which have a C++ equivalent. Possible attribute types include:</p>

<ul>
<li>simple numeric types: <em>int</em>, <em>long</em>, and <em>double</em>, which map to their C++ equivalents.</li>
<li>text-like elements: <em>string</em>, which map to <code>std::string</code>
</li>
<li>vector like quantities: <em>v2d</em>, <em>v3d</em>, <em>v4d</em> which map to <code>IgV2d</code>, <code>IgV3d</code>, <code>IgV4d</code>.</li>
</ul>

<p>Syntax:</p>

<p>type-descriptions ::= { type-description, ... }</p>

<p>type-description ::= "type-name": [attributes-description, ...]</p>

<p>type-name ::= string-literal</p>

<p>attribute-description ::= ["attribute-name", "attribute-type"]</p>

<p>attribute-name ::= string-literal</p>

<p>string-literal ::= [A-Za-z_][A-Za-z_/0-9]*</p>

<p>attribute-type ::= int OR long OR double OR string OR v2d OR v3d OR v4d</p>

<h3>
<a id="collections" class="anchor" href="#collections" aria-hidden="true"><span class="octicon octicon-link"></span></a>Collections</h3>

<p>Collections are arrays of rows, identified by a collection-name. The collection-name is a string-literal which matches one of the type-names defined in types. Rows are arrays of values, where the type of the value matches the attribute-type of the attribute-description with the same position in the type-description which has its type-name matching the collection name.</p>

<p>This is the actual data contained in a file.</p>

<p>Syntax:</p>

<p>collections ::= {collection, ... }</p>

<p>collection ::= "type-name": [row, ...]</p>

<p>row ::= [ value, ...]</p>

<p>value ::= string-literal OR numeric-literal OR vector-literal</p>

<p>numeric-literal ::= [0-9]+[.]<em>[0-9]</em></p>

<p>vector-literal ::= [numeric-literal, numeric-literal, ...]</p>

<h3>
<a id="association-sets" class="anchor" href="#association-sets" aria-hidden="true"><span class="octicon octicon-link"></span></a>Association sets</h3>

<p>An association defines a relationship between two rows found in any (possibly the same) collections. They are uniquely identified by two couples of numbers, the first one uniquely identifying the left object of the association, the other identifying the right object. The first element of this couple of numbers is the so called collection id while the second one is called object id. The collection id is the index of the collection type within the Types table, while the object id is the index of the object within the collection. Such a couple of numbers is called object reference. An association-set is an array of associations which share some common meaning decided by the writer of the ig-file.</p>

<p>Syntax:</p>

<p>associations-sets ::= { association-set, ... }</p>

<p>association-set ::= "association-set-name": [association, ...]</p>

<p>association ::= [left-object, right-object]</p>

<p>left-object ::= object-reference</p>

<p>right-object ::= object-reference</p>

<p>object-reference ::= [collection-id, object-id]</p>

<p>collection-id ::= index-literal</p>

<p>object-id ::= index-literal</p>

<p>index-literal ::= [0-9]+</p>

<h3>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h3>

<p>Here is a simple example of what an ig file looks like.</p>

<pre><code>{
 "Types": {"Tracks_V1": [["x", "double"],["y", "double"],["z", "double"],
                         ["px", "double"],["py","double"],["pz", "double"]],
           "Clusters_V1": [["x", "double"],["y", "double"],["z", "double"],
                           ["e", "double"]]
          },
 "Collections": {"Tracks_V1": [[0, 0, 0, 0, 0, 0],
                               [1, 1, 1, 1, 1, 1],
                               [2, 2, 2, 2, 2, 2],
                               [3, 3, 3, 3, 3, 3],
                               [4, 4, 4, 4, 4, 4],
                               [5, 5, 5, 5, 5, 5],
                               [6, 6, 6, 6, 6, 6],
                               [7, 7, 7, 7, 7, 7],
                               [8, 8, 8, 8, 8, 8],
                               [9, 9, 9, 9, 9, 9]],
                 "Clusters_V1": [[0, 0, 0, 0],
                                 [1, 1, 1, 1],
                                 [2, 2, 2, 2],
                                 [3, 3, 3, 3],
                                 [4, 4, 4, 4],
                                 [5, 5, 5, 5],
                                 [6, 6, 6, 6],
                                 [7, 7, 7, 7],
                                 [8, 8, 8, 8],
                                 [9, 9, 9, 9]]
                 },
 "Associations": {"TrackClusters_V1": [[[0, 0], [1, 0]],
                                       [[0, 1], [1, 1]],
                                       [[0, 2], [1, 2]],
                                       [[0, 3], [1, 3]],
                                       [[0, 4], [1, 4]],
                                       [[0, 5], [1, 5]],
                                       [[0, 6], [1, 6]],
                                       [[0, 7], [1, 7]],
                                       [[0, 8], [1, 8]],
                                       [[0, 9], [1, 9]]],
                  "TrackClusters2_V1": [[[0, 0], [1, 0]],
                                        [[0, 1], [1, 0]],
                                        [[0, 2], [1, 0]],
                                        [[0, 3], [1, 0]],
                                        [[0, 4], [1, 0]],
                                        [[0, 5], [1, 0]],
                                        [[0, 6], [1, 0]],
                                        [[0, 7], [1, 0]],
                                        [[0, 8], [1, 0]],
                                        [[0, 9], [1, 0]]]
                  }
}
</code></pre>

<h3>
<a id="apis" class="anchor" href="#apis" aria-hidden="true"><span class="octicon octicon-link"></span></a>APIs</h3>

<p>APIs for ig files can be found on github:</p>

<ul>
<li>
<a href="https://github.com/tpmccauley/igfiles">C++</a>
</li>
<li>
<a href="https://github.com/tpmccauley/pyig">python</a>
</li>
</ul>

<h1>
<a id="how-do-i-make-my-own-ig-files" class="anchor" href="#how-do-i-make-my-own-ig-files" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I make my own ig files?</h1>

<p>See an example <a href="https://github.com/cms-outreach/ispy-analyzers/blob/Run2010B/README.md">here.</a></p>

<h1>
<a id="how-do-build-it" class="anchor" href="#how-do-build-it" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do build it?</h1>

<p>iSpy uses among other libraries Qt, Coin3D, and SoQt. The relative simplicity of your build (which uses cmake) may vary. That said, in order to give it a try:</p>

<pre><code>git clone https://github.com/cms-outreach/ispy
cd ispy
git checkout linux64 (or git checkout mavericks)
cd externals
cmake .
make
cd ../
cmake .
make
</code></pre>

<h1>
<a id="how-do-i-run-it" class="anchor" href="#how-do-i-run-it" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I run it?</h1>

<p>Once downloaded (or built), iSpy should be a full-bound executable. You can double-click it or run it from the command line (you may need to chmod +x). Some files are provided via the <a href="http://www">www</a>. You can read local files from the File menu or specify them on the command line as an argument.</p>

<p>Alternatively, you can try the <a href="https://github.com/cms-outreach/ispy-online">browser-based version </a> (written in JavaScript) either offline or online.</p>

<h1>
<a id="how-do-i-change-the-colorscuts-etc" class="anchor" href="#how-do-i-change-the-colorscuts-etc" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I change the colors/cuts, etc.?</h1>

<p>iSpy uses so-called ISS files (mimicking HTML CSS files) that define the style and (graphics) cuts for any given collection displayed.</p>

<p>While a default ISS file is compiled in the executable, the user can specify his/her own file at startup time by simply passing its path on the command line.</p>

<p>The syntax of ISS is as similar as possible to the one of the usual CSS file encountered in web pages:</p>

<pre><code>      rule {
        property-name: property-value;
        ...
      }
</code></pre>

<p>Where rule is used to identify the collection name for the associated properties found in the curly brackets.</p>

<p>Notice that for the moment, due to limitations of the implementation, the rule is not really cascading and you have to fully specify all the properties related to a given collection. This will change in future.</p>

<p>To define the default style you can use the * rule and define values for all the supported properties. At the moment the default "*" rule is:</p>

<pre><code>      // Default style.
      * {
        diffuse-color: rgb(0.7, 0.7, 0.7);
        transparency: 0.0;
        line-width: 1.0;
        line-pattern: 0xffff;
        font-size: 12;
        font-family: Arial;
        draw-style: solid;
        marker-shape: square;
        marker-size: normal;
        marker-style: filled;
        text-align: left;
        min-energy: 0.2;
        max-energy: 5.0;
        energy-scale: 1.0;
        left: 0.;
        top: 0.;
      }
</code></pre>

<p>For a detailed description of all the properties see the list below.</p>

<p>Besides all the collections to be found in the ig file, there are two special collections you can configure as well: Background and Internal_Limits_V1. The former obviously controls the background color (via the diffuse-color attribute), while the latter corresponds to the overlay which displays the graphics cuts.</p>

<h2>
<a id="properties-reference" class="anchor" href="#properties-reference" aria-hidden="true"><span class="octicon octicon-link"></span></a>Properties reference</h2>

<ul>
<li>diffuse-color: the main color to be used to display the collection. It can be specified either in the HTML form #RRGGBB or in the CSS form rgb(r, g, b), where RR, GG, BB are between 0 and 255, while r, g, b are between 0 and 1.</li>
<li>transparency: the transparency level, between 0 and 1 of the object displayed to represent the collection.</li>
<li>line-width: the width of all the lines displayed for a given collection.</li>
<li>line-pattern: an hex number defining the bitmask for the line pattern. E.g. Use 0xf0f0 for a dashed line with four pixel per dash.</li>
<li>font-size: the font size of the main text in the annotation associated to the collection. All other text strings (e.g. titles) will be scaled relative to this size.</li>
<li>font-family: the font family of the main text in the annotation.</li>
<li>draw-style: the style to use to draw all the shapes associated to the collection. Can be either solid, lines, points.</li>
<li>marker-shape: the shape of markers used for the collection. It can be either square, cross, circle, plus.</li>
<li>marker-size: the size of markers used for the collection. It can be either normal, big, huge.</li>
<li>marker-style: the style of markers used for the collection. It can be either filled or outline. The filled value only applies to circle and square markers.</li>
<li>text-align: the alignment of the annotation text. Can be either left, right, center.</li>
<li>min-energy: if applicable, the minimal energy required for an element in the collection to be displayed. In GeV.</li>
<li>max-energy: if applicable, the maximum energy required for an element in the collection to be displayed. In GeV.</li>
<li>energy-scale: if applicable, the scale to use to display objects in the collection that vary in size / color according to their energy. In m / GeV.</li>
<li>top, left: when left aligned, the position of the top-left corner of an annotation. The position of the top-right corner in the case of right alignement. Varies from (0,0) to (1,1), which are the coordinates for the top-left and bottom-right corners.</li>
</ul>

<h1>
<a id="how-do-i-change-the-view-contents-the-camera-position-etc" class="anchor" href="#how-do-i-change-the-view-contents-the-camera-position-etc" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I change the view contents, the camera position, etc.?</h1>

<p>In order to configure which view are to be shown and what to show in each view, iSpy uses a so-called IML file. Such a file is a normal xml file with the following structure:</p>

<pre><code>       &lt;?xml version="1.0" encoding='UTF-8'?&gt;
       &lt;layout&gt;
       &lt;camera position="-18.1, 8.6, 14.0" pointAt="0, 0, 0" scale="10.6" orthographic="true" rotating="true"&gt;
         &lt;visibilityGroup&gt;
         &lt;view label="Standard 3D View" specialised="true" autoplay="true"&gt;
           &lt;collection label="Provenance/Event information"
                      spec="Event_V1:time:run:event:ls:orbit:bx"
                      draw="make3DEvent"/&gt;
         &lt;/view&gt;
         &lt;/visibilityGroup&gt;
       &lt;/camera&gt;
       &lt;/layout&gt;
</code></pre>

<p>The <code>&lt;layout/&gt;</code> tag is just the top-level container.</p>

<p>The <code>&lt;camera/&gt;</code> tag specifies where the default camera should be put for the contained views.</p>

<p>The <code>&lt;visibilityGroup/&gt;</code> tag specifies where the default camera should be put for the contained views.</p>

<p>The <code>&lt;view/&gt;</code> tag specifies properties of the a page view. It contains a set of <code>&lt;collection/&gt;</code>tags, as many as one per collection to be displayed.</p>

<p>As for ISS files, a default IML file is compiled in the application but the user can specify his own by passing it on the command line.</p>

<p>Attributes of the <code>&lt;camera/&gt;</code> tag</p>

<ul>
<li>position: the position of the camera.
</li>
<li>pointAt: the point at which the camera points at
</li>
<li>scale: the scale factor for elements shown
</li>
<li>orthographic: either true or false indicates whether the camera is orthographic or not.
</li>
<li>rotating: either true or false, indicates whether the camera can rotate or not. False means that the camera is in panning mode.
</li>
</ul>

<p>Attributes of the <code>&lt;view/&gt;</code> tag</p>

<ul>
<li>label: the name of the view as shown in the view selector widget
</li>
<li>autoplay: either true or false, indicates whether the view has to be shown in autoplay mode.
</li>
</ul>

<p>Attributes of the <code>&lt;collection/&gt;</code> tag</p>

<ul>label: the name of the collection, as shown in the tree view. Use a (single) slash to separate between the two levels
<li>spec: a specification that has to be matched by the collection and its properties. This is a column separated list, where the first item is the name of the collection while the subsequent items are the properties that have to be matched in order for the drawing method to apply.
</li>
<li>association: the name of an association set which links the elements of the collection specified by "spec" to those specified by "other". This attribute is optional.
</li>
<li>other: similar to spec, it defines a second collection whose items are connected to the one specified in "spec" thanks to the associations specified in "associations"
</li>
<li>draw: the name of the drawing method to be executed on the collection where the specification found in spec applies.
</li>
</ul>

<p>List of draw operations</p>

<ul>
<li>make3DAnyBox: draw a box in 3D, without any special projection. Coordinates from the vertices are picked up from the following columns of the collection:
```
        front_1
        front_2
        front_3
        front_4
        back_1
        back_2
        back_3
        back_4
```   
</li>
<li>makeAnyBox: draw a box in 3D, using the projection specified for the given view. Coordinates from the vertices are picked up from the following columns of the collection:
```
        front_1
        front_2
        front_3
        front_4
        back_1
        back_2
        back_3
        back_4
```
</li>
<li>make3DAnyLine: draws a generic set of lines using the coordinates found in the columns "pos1" and "pos2" of the given collection.
</li>
<li>make3DAnyPoint: draws a generic set of points. The pos column of the collection is used to draw.
</li>
<li>make3DCSCStripDigis
</li>
<li>make3DCSCWireDigis
</li>
<li>make3DCaloClusters
</li>
<li>make3DCaloTowers
</li>
<li>make3DDTDigis
</li>
<li>make3DDTRecHits
</li>
<li>make3DEnergyBoxes
</li>
<li>make3DEnergyTowers
</li>
<li>make3DEvent
</li>
<li>make3DHLTrigger
</li>
<li>make3DJetShapes
</li>
<li>make3DL1Trigger
</li>
<li>make3DLimits
</li>
<li>make3DMET
</li>
<li>make3DPhoton
</li>
<li>makeRZPhoton
</li>
<li>makeAnyPhoton
</li>
<li>make3DPointSetShapes
</li>
<li>makeRZPointSetShapes
</li>
<li>makeAnyPointSetShapes
</li>
<li>make3DPreshowerTowers
</li>
<li>make3DRPCRecHits
</li>
<li>make3DSegmentShapes
</li>
<li>make3DTechTrigger
</li>
<li>make3DTrackPoints
</li>
<li>make3DTrackingParticles
</li>
<li>make3DTracks
</li>
<li>makeRZTracks
</li>
<li>makeAnyTracks
</li>
<li>make3DTracksNoVertex
</li>
<li>make3DTriggerObject
</li>
<li>makeLegoCaloTowers
</li>
<li>makeLegoEcalRecHits
</li>
<li>makeLegoGrid
</li>
<li>makeLegoHcalRecHits
</li>
<li>makeLegoJets
</li>
<li>makeRZECalRecHits
</li>
<li>makeRZEPRecHits
</li>
<li>makeRZHCalRecHits
</li>
</ul>

<h1>
<a id="contributors" class="anchor" href="#contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributors</h1>

<h2>
<a id="ispy-contributors" class="anchor" href="#ispy-contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>iSpy contributors</h2>

<p>George Alverson, Giulio Eulisse, Thomas McCauley, Lucas Taylor.</p>

<h2>
<a id="former-contributors" class="anchor" href="#former-contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Former contributors</h2>

<p>Shahzad Muzaffar, Ianna Osborne, Lassi Tuura. </p>

<h1>
<a id="contact" class="anchor" href="#contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contact</h1>

<p><a href="mailto:ispy-developers@cern.ch"></a><a href="mailto:ispy-developers@cern.ch">ispy-developers@cern.ch</a></p>

<h1>
<a id="reference" class="anchor" href="#reference" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reference</h1>

<p>J.Phys.Conf.Ser. 396 (2012) 022002 (DOI: <a href="http://dx.doi.org/10.1088/1742-6596/396/2/022002">10.1088/1742-6596/396/2/022002</a>)</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/cms-outreach">cms-outreach</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>